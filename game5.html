<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <title>冒險飛行：星際戰爭</title>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/brython@3.11.0/brython.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/brython@3.11.0/brython_stdlib.js"></script>
    <style>
        body { font-family:'Arial', sans-serif; background:#000; color:#fff; text-align:center; margin:0; padding:0; }
        h1 { font-size:40px; margin-top:20px; color:#ff6347; text-shadow:2px2px10px rgba(0,0,0,0.5);}
        #menu, #settings {margin-top:50px;}
        .menu-btn, .setting-btn {padding:15px 30px; font-size:22px; margin:10px; border:none; border-radius:10px; cursor:pointer; transition:0.3s;}
        .menu-btn:hover, .setting-btn:hover {background-color:#ff4500;}
        canvas {display:block; margin:20px auto; border:5px solid #ff6347; border-radius:10px; background:#000;}
        #info {font-size:24px; margin:10px; background:rgba(0,0,0,0.5); border-radius:10px; padding:10px; width:80%; margin-left:auto; margin-right:auto;}
        #settings {display:none;}
        #menu, #info {display:block;}
    </style>
</head>
<body onload="brython()">
    <h1>冒險飛行：星際戰爭</h1>
    <div id="menu">
        <button class="menu-btn" id="easy">簡單</button>
        <button class="menu-btn" id="medium">中等</button>
        <button class="menu-btn" id="hard">困難</button>
        <button class="menu-btn" id="settings-btn">設定</button>
    </div>

    <div id="settings">
        <button class="setting-btn" id="sound-on">開啟音效</button>
        <button class="setting-btn" id="sound-off">關閉音效</button>
        <button class="setting-btn" id="back-to-menu">返回主頁</button>
    </div>

    <div id="info" style="display:none;">
        <span id="score">分數：0</span> | 
        <span id="health">生命：100</span> | 
        <span id="level">關卡：1</span>
    </div>

    <canvas id="game" width="800" height="600" style="display:none;"></canvas>
    <button class="menu-btn" id="resetButton" style="display:none;">重新開始</button>

    <script type="text/python">
        from browser import document, html, window, timer
        import random

        canvas = document["game"]
        ctx = canvas.getContext("2d")
        reset_button = document["resetButton"]
        menu_div = document["menu"]
        settings_div = document["settings"]
        info_div = document["info"]

        # 遊戲狀態
        score = 0
        health = 100
        level = 1
        player_x = 100
        player_y = 500
        player_width = 60
        player_height = 60
        player_speed = 6
        enemies = []
        keys = {"w": False, "a": False, "s": False, "d": False}
        stars = []
        spawn_interval = 2000
        enemy_speed_base = 5
        sound_on = True  # 音效開關

        # 初始背景生成星星
        for i in range(150):
            stars.append([random.randint(0, canvas.width), random.randint(0, canvas.height)])

        def play_sound(effect):
            if sound_on:
                # 假設有一些音效
                if effect == "hit":
                    pass  # 播放撞擊音效
                elif effect == "level_up":
                    pass  # 播放升級音效

        def draw_background():
            # 隨機生成星空背景
            gradient = ctx.createLinearGradient(0, 0, 0, canvas.height)
            gradient.addColorStop(0, "#001f3d")
            gradient.addColorStop(1, "#1f5b8b")
            ctx.fillStyle = gradient
            ctx.fillRect(0, 0, canvas.width, canvas.height)

            ctx.fillStyle = "white"
            for star in stars:
                star[1] += 0.2  # 星星移動
                if star[1] > canvas.height:
                    star[1] = 0
                    star[0] = random.randint(0, canvas.width)
                ctx.beginPath()
                ctx.arc(star[0], star[1], 1, 0, window.Math.PI*2)
                ctx.fill()

        def draw_player():
            ctx.fillStyle = "gray"
            ctx.beginPath()
            ctx.moveTo(player_x + player_width/2, player_y)
            ctx.lineTo(player_x + player_width, player_y + player_height/3)
            ctx.lineTo(player_x + player_width/3, player_y + player_height)
            ctx.lineTo(player_x + player_width/1.5, player_y + player_height/1.5)
            ctx.lineTo(player_x + player_width/2, player_y + player_height/1.3)
            ctx.lineTo(player_x + player_width/3, player_y + player_height/1.5)
            ctx.closePath()
            ctx.fill()
            ctx.fillStyle = "lightgray"
            ctx.beginPath()
            ctx.moveTo(player_x + player_width/3, player_y + player_height/3)
            ctx.lineTo(player_x + player_width/2, player_y + player_height/5)
            ctx.lineTo(player_x + player_width/1.2, player_y + player_height/3)
            ctx.closePath()
            ctx.fill()

        def move_player():
            global player_x, player_y
            if keys["w"] and player_y>0: player_y -= player_speed
            if keys["s"] and player_y<canvas.height-player_height: player_y += player_speed
            if keys["a"] and player_x>0: player_x -= player_speed
            if keys["d"] and player_x<canvas.width-player_width: player_x += player_speed

        def spawn_enemy():
            size = random.randint(30,60)
            x = random.randint(0, canvas.width-size)
            y = 0
            enemy_type = random.choice(["UFO","Missile","Drone"])
            enemies.append([x, y, size, enemy_type])

        def draw_enemies():
            global health
            for enemy in enemies:
                enemy[1] += enemy_speed_base + level//2
                if enemy[3]=="UFO":
                    ctx.fillStyle="lightgreen"
                    ctx.beginPath()
                    ctx.ellipse(enemy[0]+enemy[2]/2, enemy[1]+enemy[2]/2, enemy[2]/2, enemy[2]/4,0,0,window.Math.PI*2)
                    ctx.fill()
                elif enemy[3]=="Missile":
                    ctx.fillStyle="red"
                    ctx.fillRect(enemy[0], enemy[1], enemy[2]/3, enemy[2]*2)
                    ctx.fillStyle="white"
                    ctx.beginPath()
                    ctx.arc(enemy[0]+enemy[2]/6, enemy[1],6,0,window.Math.PI*2)
                    ctx.fill()
                elif enemy[3]=="Drone":
                    ctx.fillStyle="gray"
                    ctx.fillRect(enemy[0], enemy[1], enemy[2], enemy[2]/2)

                if player_x<enemy[0]+enemy[2] and player_x+player_width>enemy[0] and player_y<enemy[1]+enemy[2] and player_y+player_height>enemy[1]:
                    health -= 10
                    play_sound("hit")
                    enemies.remove(enemy)
                if enemy[1]>canvas.height:
                    enemies.remove(enemy)

        def update_game():
            global score, level
            if health<=0:
                end_game()
                return
            ctx.clearRect(0,0,canvas.width,canvas.height)
            draw_background()
            draw_player()
            move_player()
            draw_enemies()
            score += 1
            if score % 100 == 0: level += 1
            document["score"].text = f"分數：{score}"
            document["health"].text = f"生命：{health}"
            document["level"].text = f"關卡：{level}"

        def end_game():
            reset_button.style.display="inline-block"
            ctx.fillStyle="white"
            ctx.font="30px Arial"
            ctx.fillText("遊戲結束！", canvas.width/2-100, canvas.height/2)
            ctx.fillText(f"最終得分：{score}", canvas.width/2-100, canvas.height/2+50)
            timer.clear_interval(game_timer)

        def reset_game(evt):
            global score, health, level, player_x, player_y, enemies, game_timer
            score=0; health=100; level=1; player_x=100; player_y=500; enemies=[]
            stars.clear()
            for i in range(150): stars.append([random.randint(0,canvas.width),random.randint(0,canvas.height)])
            document["score"].text=f"分數：{score}"
            document["health"].text=f"生命：{health}"
            document["level"].text=f"關卡：{level}"
            reset_button.style.display="none"
            game_timer=timer.set_interval(update_game,50)

        def on_key_down(evt):
            if evt.key=="w": keys["w"]=True
            elif evt.key=="a": keys["a"]=True
            elif evt.key=="s": keys["s"]=True
            elif evt.key=="d": keys["d"]=True

        def on_key_up(evt):
            if evt.key=="w": keys["w"]=False
            elif evt.key=="a": keys["a"]=False
            elif evt.key=="s": keys["s"]=False
            elif evt.key=="d": keys["d"]=False

        window.bind("keydown", on_key_down)
        window.bind("keyup", on_key_up)
        reset_button.bind("click", reset_game)

        # 難度選擇
        def start_game(evt):
            global spawn_interval, enemy_speed_base, health, game_timer
            diff = evt.target.id
            if diff=="easy":
                spawn_interval=2500
                enemy_speed_base=3
                health=150
            elif diff=="medium":
                spawn_interval=2000
                enemy_speed_base=5
                health=100
            else:
                spawn_interval=1500
                enemy_speed_base=7
                health=80
            menu_div.style.display="none"
            settings_div.style.display="none"
            info_div.style.display="block"
            canvas.style.display="block"
            document["health"].text=f"生命：{health}"
            spawn_enemy_timer=timer.set_interval(spawn_enemy, spawn_interval)
            game_timer=timer.set_interval(update_game,50)

        document["easy"].bind("click", start_game)
        document["medium"].bind("click", start_game)
        document["hard"].bind("click", start_game)

        # 設定頁面操作
        def show_settings(evt):
            menu_div.style.display="none"
            settings_div.style.display="block"

        def hide_settings(evt):
            menu_div.style.display="block"
            settings_div.style.display="none"

        document["settings-btn"].bind("click", show_settings)
        document["back-to-menu"].bind("click", hide_settings)

        def toggle_sound(evt):
            global sound_on
            sound_on = not sound_on
            if sound_on:
                document["sound-on"].style.backgroundColor = "#ff4500"
                document["sound-off"].style.backgroundColor = "#f0f0f0"
            else:
                document["sound-off"].style.backgroundColor = "#ff4500"
                document["sound-on"].style.backgroundColor = "#f0f0f0"

        document["sound-on"].bind("click", toggle_sound)
        document["sound-off"].bind("click", toggle_sound)

    </script>
</body>
</html>
